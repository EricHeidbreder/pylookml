{
	'connection': 'snowflake',
	'label': '1) eCommerce with Event Data',
	'includes': ['*.view'],
	'datagroups': [{
		'sql_trigger': 'SELECT max(completed_at) FROM ecomm.etl_jobs',
		'max_cache_age': '24 hours',
		'name': 'ecommerce_etl'
	}],
	'persist_with': 'ecommerce_etl',
	'explores': [
        {
		'label': '(1) Orders, Items and Users',
		'view_name': 'order_items',
		'joins': [
            {
			'type': 'left_outer',
			'view_label': 'Orders',
			'relationship': 'many_to_one',
			'sql_on': '${order_facts.order_id} = ${order_items.order_id}',
			'name': 'order_facts'
		}, {
			'type': 'full_outer',
			'relationship': 'one_to_one',
			'sql_on': '${inventory_items.id} = ${order_items.inventory_item_id}',
			'name': 'inventory_items'
		}, {
			'type': 'left_outer',
			'relationship': 'many_to_one',
			'sql_on': '${order_items.user_id} = ${users.id}',
			'name': 'users'
		}, {
			'view_label': 'Users',
			'type': 'left_outer',
			'relationship': 'many_to_one',
			'sql_on': '${user_order_facts.user_id} = ${order_items.user_id}',
			'name': 'user_order_facts'
		}, {
			'type': 'left_outer',
			'relationship': 'many_to_one',
			'sql_on': '${products.id} = ${inventory_items.product_id}',
			'name': 'products'
		}, {
			'relationship': 'many_to_one',
			'type': 'full_outer',
			'sql_on': '${order_items.order_id} = ${repeat_purchase_facts.order_id}',
			'name': 'repeat_purchase_facts'
		}, {
			'type': 'left_outer',
			'sql_on': '${distribution_centers.id} = ${inventory_items.product_distribution_center_id}',
			'relationship': 'many_to_one',
			'name': 'distribution_centers'
		}],
		'name': 'order_items'
	}, {
		'label': '(2) Web Event Data',
		'joins': [{
			'type': 'left_outer',
			'sql_on': '${events.session_id} =  ${sessions.session_id}',
			'relationship': 'many_to_one',
			'name': 'sessions'
		}, {
			'from': 'events',
			'type': 'left_outer',
			'sql_on': '${sessions.landing_event_id} = ${session_landing_page.event_id}',
			'fields': ['simple_page_info*'],
			'relationship': 'one_to_one',
			'name': 'session_landing_page'
		}, {
			'from': 'events',
			'type': 'left_outer',
			'sql_on': '${sessions.bounce_event_id} = ${session_bounce_page.event_id}',
			'fields': ['simple_page_info*'],
			'relationship': 'many_to_one',
			'name': 'session_bounce_page'
		}, {
			'from': 'products',
			'type': 'left_outer',
			'sql_on': '${events.viewed_product_id} = ${product_viewed.id}',
			'relationship': 'many_to_one',
			'name': 'product_viewed'
		}, {
			'type': 'left_outer',
			'sql_on': '${sessions.session_user_id} = ${users.id}',
			'relationship': 'many_to_one',
			'name': 'users'
		}, {
			'type': 'left_outer',
			'sql_on': '${users.id} = ${user_order_facts.user_id}',
			'relationship': 'one_to_one',
			'view_label': 'Users',
			'name': 'user_order_facts'
		}],
		'name': 'events'
	}, {
		'label': '(3) Web Session Data',
		'joins': [{
			'type': 'left_outer',
			'sql_on': '${sessions.session_id} = ${events.session_id}',
			'relationship': 'one_to_many',
			'name': 'events'
		}, {
			'from': 'products',
			'type': 'left_outer',
			'sql_on': '${events.viewed_product_id} = ${product_viewed.id}',
			'relationship': 'many_to_one',
			'name': 'product_viewed'
		}, {
			'from': 'events',
			'type': 'left_outer',
			'sql_on': '${sessions.landing_event_id} = ${session_landing_page.event_id}',
			'fields': ['session_landing_page.simple_page_info*'],
			'relationship': 'one_to_one',
			'name': 'session_landing_page'
		}, {
			'from': 'events',
			'type': 'left_outer',
			'sql_on': '${sessions.bounce_event_id} = ${session_bounce_page.event_id}',
			'fields': ['session_bounce_page.simple_page_info*'],
			'relationship': 'one_to_one',
			'name': 'session_bounce_page'
		}, {
			'type': 'left_outer',
			'relationship': 'many_to_one',
			'sql_on': '${users.id} = ${sessions.session_user_id}',
			'name': 'users'
		}, {
			'type': 'left_outer',
			'relationship': 'many_to_one',
			'sql_on': '${user_order_facts.user_id} = ${users.id}',
			'view_label': 'Users',
			'name': 'user_order_facts'
		}],
		'name': 'sessions'
	}, {
		'label': '(4) Affinity Analysis',
		'always_filter': {
			'filters': [{
				'field': 'affinity.product_b_id',
				'value': '-NULL'
			}]
		},
		'joins': [{
			'from': 'products',
			'type': 'left_outer',
			'view_label': 'Product A Details',
			'relationship': 'many_to_one',
			'sql_on': '${affinity.product_a_id} = ${product_a.id}',
			'name': 'product_a'
		}, {
			'from': 'products',
			'type': 'left_outer',
			'view_label': 'Product B Details',
			'relationship': 'many_to_one',
			'sql_on': '${affinity.product_b_id} = ${product_b.id}',
			'name': 'product_b'
		}],
		'name': 'affinity'
	}, {
		'label': '(5) Share of Wallet Analysis',
		'extends': ['order_items'],
		'view_name': 'order_items',
		'joins': [{
			'view_label': 'Share of Wallet',
			'name': 'order_items_share_of_wallet'
		}],
		'name': 'orders_with_share_of_wallet_application'
	}, {
		'label': '(6) Customer Journey Mapping',
		'extends': ['order_items'],
		'view_name': 'order_items',
		'joins': [{
			'relationship': 'many_to_one',
			'sql_on': '${repeat_purchase_facts.next_order_id} = ${order_items.order_id}',
			'type': 'left_outer',
			'name': 'repeat_purchase_facts'
		}, {
			'type': 'left_outer',
			'from': 'order_items',
			'sql_on': '${repeat_purchase_facts.next_order_id} = ${next_order_items.order_id}',
			'relationship': 'many_to_many',
			'name': 'next_order_items'
		}, {
			'type': 'left_outer',
			'from': 'inventory_items',
			'relationship': 'many_to_one',
			'sql_on': '${next_order_items.inventory_item_id} = ${next_order_inventory_items.id}',
			'name': 'next_order_inventory_items'
		}, {
			'from': 'products',
			'type': 'left_outer',
			'relationship': 'many_to_one',
			'sql_on': '${next_order_inventory_items.product_id} = ${next_order_products.id}',
			'name': 'next_order_products'
		}],
		'name': 'journey_mapping'
	}, {
		'label': '(7) Historical Stock Snapshot Analysis',
		'joins': [{
			'sql_on': '${inventory_snapshot.product_id}=${trailing_sales_snapshot.product_id}\n    AND ${inventory_snapshot.snapshot_date}=${trailing_sales_snapshot.snapshot_date}',
			'type': 'left_outer',
			'relationship': 'one_to_one',
			'name': 'trailing_sales_snapshot'
		}, {
			'type': 'left_outer',
			'sql_on': '${inventory_snapshot.product_id} = ${products.id}',
			'relationship': 'many_to_one',
			'name': 'products'
		}, {
			'type': 'left_outer',
			'sql_on': '${products.distribution_center_id}=${distribution_centers.id}',
			'relationship': 'many_to_one',
			'name': 'distribution_centers'
		}],
		'name': 'inventory_snapshot'
	}, {
		'label': 'Order Items (Kittens)',
		'hidden': 'yes',
		'extends': ['order_items'],
		'joins': [{
			'view_label': 'Kittens',
			'from': 'kitten_users',
			'name': 'users'
		}],
		'name': 'kitten_order_items'
	}]
}